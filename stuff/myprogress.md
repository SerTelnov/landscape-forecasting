# Прогресс в выполнение дипломной работы

## 1. Постановка проблемы (или как я понял о чем идет речь)

### Какую проблему решаем
Нужно для рекламодателя оценивать `рыночную цену`, в зависимости от `запроса`.

В `запрос` входит информация о пользователе, о показе рекламного объявления (на каком сайте и размер рекламного объявления) и содержимое рекламы ((?) что это именно не очень понял)

`Рыночная цена` вторая по величине ставка. О ней узнает только победитель аукциона

### Как решаем проблему

bidding logs ((?) - это же информация о пройденном аукционе)
Храниться как тройка значений *x* `запрос`, *b* `ставка`, *z* `рыночная цена`.

Основня задача - оценить плотность распределения рыночный цены, из полученного запроса.

#### Пункт 1
Обозначим вероятности.
Разбили величины ставков на интервалы и дальше считали вероятность события попадения `рыночной цены` в l-ый интервал
Используем теорию вероятности и определением функции выигрыша, и проигрыша и на их основе вероятность выигрыша.
#### Пункт 2
Нужна вероятность случайного события при условии запроса рекламодателя. Тут люди использовали `Recurrent Neural Networks` и получили вероясность события что рыночная цена принадлежит l-ому интервалу ставки, при условии запроса рекламодетеля.
#### Пункт 3
Решение задачи оптимизации. Ввели функции потерь и выбирают наилучший параметр для алгоритма в `пункте 2`.


### Что сделать еще
* [X] Разобраться в методе подсчета ошибки
* [X] Разобраться с Recurrent Neural Network приведенное в статье
* [X] Найти статьи решающие похожую задачу

## 2. Разобраться в реализации решения, приведенного в статье

### Что сделать тут
* [X] Для начала запустить, потыкать, подебажить
* [X] Посмотреть что за датасеты и тд
* [X] Разобраться где core, как написали сеть
* [X] Почитать статьи и написать на них обзор

### [Статья KN](http://apex.sjtu.edu.cn/public/files/members/20160929/functional-bid-lands.pdf) решение с помощью Decision Tree

Решали аналогичную задачу: найти плотность распределение рыночной цени и вероятность выиграша

то есть надо найти функцию $T_p(x)$ которая для заданого запроса $x$ найдет распределение цен $p_x(z) = T_p(x)$

Эту функцию ищу с помощью решающих деревьем.

Основная особенность в том что в разбиение используют неклассические функции (например энтропию или коэффициент Джини), а решают задачу кластаризации. (На данным момент про задачу кластеризации знаю почти ничего :disappoint:)

На каждом шаге (когда разбивают на поддеревью) максимизируют показатель  KL-Divergence $D_{KL}$, который в их формуле зависит от плотности распределения двух поддеревьев (формула есть в статье).

Используя задачу K-Means clustering строят деревья
TODO К чему пришли в конце и как получили распределения

### [DeepHit](https://aaai.org/ocs/index.php/AAAI/AAAI18/paper/view/16160/15945) is a deep neural network model which predicts the probability of each bidding price from the minimum price to the maximum price

Статья никак не связана со ставками и рекламой. Но решают аналогичную задачу. Используют глубокое обучение, но с какими-то более хитрими нейтонками. 

TODO перечитать и дописать


### [DeepSurv](https://arxiv.org/pdf/1606.00931v3.pdf) is a Cox proportional hazard model with deep neural network  for feature extraction upon the sample covariates. The loss function is the negative partial likelihood of the winning and losing outcomes.

Дальше на почитать
- http://www0.cs.ucl.ac.uk/staff/w.zhang/rtb-papers/win-price-pred.pdf

## 3. Подробный разбор статей

### Что сделать тут
* [X] Прочитать и разобрать статью решение задачи до использования ML
* [ ] Подробнее разобраться в моделе нейронки в основной статье
* [ ] Доделать обзор статьей в пункте выше

### Простой подход к решению задачи
Описание [Kaplan Meier](https://towardsdatascience.com/kaplan-meier-curves-c5768e349479), [статья решения](http://wnzhang.net/papers/unbias-kdd.pdf)

Сначала переводят лог данных из <b, z, w> в лог <b, d, n>. Чтобы свести задачу к формуле Kaplan–Meier. В которой survival function записывается как $$S(t) = \prod (1 - d_i \over n_i)$$ вероятность, что жизнь будет дольше чем t ((?) Как именно мы задачу survival analiz сводим на ставки).

Аналогично формуле KM, получаем вероятность проигрыша и выигрыша.

Дальше записиывают задачу минимизации (формула 6), после уравнение эмпирического риска (формула 7).

После как формулы потерь используют задачу логистической регресии. 
(?) Как я понял зачем. Логистическая регресия может дать апостериорную вероятность принадлежности объекта к классу. В этом случае задача классификации { -1, +1 } кликнут/не кликнут.

Потом написывают формулу для шага градиентного спуска.
И решешают во второй половине задачу оптимации кликов.

(?) Так а распределение вероятности то где???

### Подробнее про нейронку из основной статьи

Первый слой переводит набор аттрибутов в вектор [embedding layer](https://towardsdatascience.com/deep-learning-4-embedding-layers-f9a02d55ac12).

[Функция](https://github.com/SerTelnov/DLF/blob/master/python/BASE_MODEL.py#L244), где задается модель из статьи

[Статья](https://towardsdatascience.com/lstm-by-example-using-tensorflow-feb0c1968537) разобра работы tensorflow с LSTM

(?) Что за time step? Это оно https://stats.stackexchange.com/questions/264546/difference-between-samples-time-steps-and-features-in-neural-network

## 4. Запуск кода на каком-то сервере

### Что сделать тут
[X] Выбрать какой-то облачный сервер для запуска модели и разобраться в нем
[X] Перевести код (хотя бы DLF) на python3
[ ] Запустить с настоящим датасетом
[ ] Решить самому какую-то простую задачу с LSTM с использованием tensorflow и запушить на aws

Посмотрел на модный google colab. Для нашей задачи наверно не очень подходит, потому что у нас достаточно большой датасет (8.9 Гб) плюс он скорее всего будет не один.

Поднял сервер на AWS, потыкал что там есть, загрузил код

Надоело разбираться с приколами aws, текущая проблема была с python2, tensorflow и все другое работает с python3. В любом случае надо бы перевести на третий питон, а то стыд какой-то

